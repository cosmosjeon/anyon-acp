{
  "timestamp": "2025-12-20T00:00:00.000Z",
  "summary": {
    "critical": 27,
    "warning": 114,
    "info": 243,
    "total": 384,
    "pass": false,
    "grade": "C"
  },
  "areas": {
    "frontend": {
      "critical": 18,
      "warning": 42,
      "info": 21,
      "grade": "C",
      "filesAnalyzed": 236,
      "linesOfCode": 7988
    },
    "desktop": {
      "critical": 7,
      "warning": 66,
      "info": 218,
      "grade": "C+",
      "filesAnalyzed": 33,
      "linesOfCode": 14788
    },
    "server": {
      "critical": 2,
      "warning": 6,
      "info": 4,
      "grade": "C+",
      "filesAnalyzed": 2,
      "linesOfCode": 425
    }
  },
  "issues": [
    {
      "id": "frontend-bloater-001",
      "priority": "P1",
      "area": "frontend",
      "type": "bloater",
      "title": "ClaudeCodeSession.tsx is 1,723 lines",
      "file": "src/components/ClaudeCodeSession.tsx",
      "line": null,
      "action": "split_file",
      "description": "God component with 10+ responsibilities including session management, message handling, streaming, checkpoints, timeline, analytics, attachments, slash commands, preview, and path management",
      "fix": {
        "type": "refactor",
        "target": "src/components/ClaudeCodeSession.tsx",
        "replacement": "Split into ClaudeSession.tsx (~200 lines) + useSessionState.ts + useStreamingState.ts + types.ts"
      }
    },
    {
      "id": "frontend-bloater-002",
      "priority": "P1",
      "area": "frontend",
      "type": "bloater",
      "title": "FloatingPromptInput.tsx is 1,543 lines",
      "file": "src/components/FloatingPromptInput.tsx",
      "line": null,
      "action": "split_file",
      "description": "Monolithic input component with model picker, file picker, image handling, slash commands, execution mode, components, IME, and shortcuts",
      "fix": {
        "type": "refactor",
        "target": "src/components/FloatingPromptInput.tsx",
        "replacement": "Split into FloatingPromptInput.tsx (~300 lines) + ModelPicker.tsx + ExecutionModePicker.tsx + AttachmentsBar.tsx + InputTextarea.tsx"
      }
    },
    {
      "id": "frontend-bloater-003",
      "priority": "P1",
      "area": "frontend",
      "type": "bloater",
      "title": "Settings.tsx is 1,279 lines",
      "file": "src/components/Settings.tsx",
      "line": null,
      "action": "split_file",
      "description": "14 different responsibilities including appearance, privacy, AI config, account, and subscription settings",
      "fix": {
        "type": "refactor",
        "target": "src/components/Settings.tsx",
        "replacement": "Split into Settings.tsx (~200 lines) + AppearanceSettings.tsx + PrivacySettings.tsx + AISettings/ folder + AccountSettings.tsx"
      }
    },
    {
      "id": "frontend-tech-debt-001",
      "priority": "P1",
      "area": "frontend",
      "type": "tech_debt",
      "title": "218 console.log statements in production code",
      "file": "src/",
      "line": null,
      "action": "remove_log",
      "description": "Console.log statements cause performance degradation and information leakage",
      "fix": {
        "type": "replace",
        "target": "console.log",
        "replacement": "createLogger('module').debug()"
      }
    },
    {
      "id": "frontend-type-safety-001",
      "priority": "P2",
      "area": "frontend",
      "type": "type_safety",
      "title": "218 any type usages",
      "file": "src/",
      "line": null,
      "action": "add_type",
      "description": "Use of any compromises TypeScript type safety benefits",
      "fix": {
        "type": "refactor",
        "target": "any",
        "replacement": "Proper typed interfaces"
      }
    },
    {
      "id": "frontend-duplication-001",
      "priority": "P1",
      "area": "frontend",
      "type": "duplication",
      "title": "MODELS constant duplicated in 3+ files",
      "file": "src/components/FloatingPromptInput.tsx",
      "line": 206,
      "action": "extract_utility",
      "description": "Same model picker logic duplicated across multiple files",
      "fix": {
        "type": "create",
        "target": "src/constants/models.ts",
        "replacement": "export const MODELS: Model[] = [...]"
      }
    },
    {
      "id": "frontend-workflow-001",
      "priority": "P1",
      "area": "frontend",
      "type": "bloater",
      "title": "Workflow configs stored as TS strings (~7,500 lines)",
      "file": "src/constants/workflows/",
      "line": null,
      "action": "refactor_function",
      "description": "YAML workflow configurations embedded in TypeScript files as template strings",
      "fix": {
        "type": "refactor",
        "target": "src/constants/workflows/*.ts",
        "replacement": "Move to .anyon/workflows/*.yaml with runtime loading"
      }
    },
    {
      "id": "desktop-bloater-001",
      "priority": "P0",
      "area": "desktop",
      "type": "bloater",
      "title": "agents.rs is 2,036 lines",
      "file": "src-tauri/src/commands/agents.rs",
      "line": null,
      "action": "split_file",
      "description": "Multiple responsibilities: database, process spawning, metrics, GitHub, WebSocket, file ops",
      "fix": {
        "type": "refactor",
        "target": "src-tauri/src/commands/agents.rs",
        "replacement": "Split into agents/mod.rs + database.rs + execution.rs + metrics.rs + github.rs + types.rs"
      }
    },
    {
      "id": "desktop-bloater-002",
      "priority": "P0",
      "area": "desktop",
      "type": "bloater",
      "title": "start_dev_server() is 215 lines",
      "file": "src-tauri/src/commands/dev_server.rs",
      "line": 578,
      "action": "refactor_function",
      "description": "Long function with port detection, package manager, process spawning, proxy, and output monitoring",
      "fix": {
        "type": "refactor",
        "target": "start_dev_server()",
        "replacement": "Split into prepare_dev_server_config() + spawn_dev_process() + spawn_output_monitors()"
      }
    },
    {
      "id": "desktop-safety-001",
      "priority": "P0",
      "area": "desktop",
      "type": "security",
      "title": "54 unwrap() calls creating panic risk",
      "file": "src-tauri/src/",
      "line": null,
      "action": "replace_pattern",
      "description": "unwrap() in async/request handlers can crash the entire application",
      "fix": {
        "type": "replace",
        "target": ".unwrap()",
        "replacement": ".map_err(|e| e.to_string())? or .unwrap_or_else(|| default)"
      }
    },
    {
      "id": "desktop-duplication-001",
      "priority": "P1",
      "area": "desktop",
      "type": "duplication",
      "title": "157 lines duplicate environment setup",
      "file": "src-tauri/src/claude_binary.rs",
      "line": 622,
      "action": "extract_utility",
      "description": "create_command_with_env() and create_tokio_command_with_env() have 95% identical code",
      "fix": {
        "type": "create",
        "target": "CommandEnv struct",
        "replacement": "Extract shared logic to CommandEnv::from_program().apply_to_command()"
      }
    },
    {
      "id": "desktop-bloater-003",
      "priority": "P1",
      "area": "desktop",
      "type": "bloater",
      "title": "web_server.rs is 986 lines",
      "file": "src-tauri/src/web_server.rs",
      "line": null,
      "action": "split_file",
      "description": "Mixed HTTP routes, WebSocket server, and Claude execution",
      "fix": {
        "type": "refactor",
        "target": "src-tauri/src/web_server.rs",
        "replacement": "Split into web/mod.rs + routes/ + websocket.rs + claude_exec.rs"
      }
    },
    {
      "id": "server-arch-001",
      "priority": "P0",
      "area": "server",
      "type": "bloater",
      "title": "Monolithic file structure (376 lines)",
      "file": "server/index.js",
      "line": null,
      "action": "split_file",
      "description": "All server logic in single file needs modularization",
      "fix": {
        "type": "refactor",
        "target": "server/index.js",
        "replacement": "Split into config/, middleware/, routes/, services/, models/, utils/"
      }
    },
    {
      "id": "server-data-001",
      "priority": "P0",
      "area": "server",
      "type": "security",
      "title": "In-memory database causes data loss",
      "file": "server/index.js",
      "line": 89,
      "action": "refactor_function",
      "description": "All data lost on server restart or crash",
      "fix": {
        "type": "refactor",
        "target": "const users = new Map()",
        "replacement": "Implement SQLite with better-sqlite3 or PostgreSQL"
      }
    },
    {
      "id": "server-sec-001",
      "priority": "P0",
      "area": "server",
      "type": "security",
      "title": "Dev endpoints not environment-guarded",
      "file": "server/index.js",
      "line": 140,
      "action": "replace_pattern",
      "description": "Development endpoints exposed in production",
      "fix": {
        "type": "replace",
        "target": "app.post('/auth/dev/login'",
        "replacement": "if (NODE_ENV !== 'production') { app.post('/auth/dev/login' ... }"
      }
    }
  ],
  "recommendations": {
    "P0": [
      "Implement SQLite database for server (prevents data loss)",
      "Guard dev endpoints with environment check",
      "Fix critical unwrap() calls in Rust (prevents crashes)",
      "Extract duplicate environment setup in claude_binary.rs"
    ],
    "P1": [
      "Split ClaudeCodeSession.tsx (1,723 → ~300 lines)",
      "Split FloatingPromptInput.tsx (1,543 → ~300 lines)",
      "Split Settings.tsx (1,279 → ~200 lines)",
      "Move workflow configs to YAML files (~7,500 lines reduction)",
      "Split agents.rs into 5-6 modules",
      "Split web_server.rs into modules",
      "Replace console.log with proper logger (218 instances)",
      "Modularize server into routes/services/middleware"
    ],
    "P2": [
      "Fix 218 any types in frontend",
      "Complete 21 TODO items in frontend",
      "Audit clone() usage in Rust (203 occurrences)",
      "Add Winston logger to server",
      "Add Zod input validation to server",
      "Consider TypeScript migration for server"
    ]
  },
  "metadata": {
    "workflow": "BMAD Code Audit v1.0",
    "agents": ["Frontend Auditor", "Desktop Auditor", "Server Auditor"],
    "parallelExecution": true,
    "executionTime": "~3 minutes",
    "nextReview": "2025-01-20"
  }
}
